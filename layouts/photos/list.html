<!DOCTYPE html>
<html>

<!-- https://codepen.io/pasyuk/pen/vgQgyb -->
<!-- https://github.com/liwenyip/hugo-easy-gallery -->

{{ partial "head_photos.html" . }}

<body>
  <h1>Heeeelelo from layouts!!!</h1>

  <div class="grid p4 p-responsive wrap">

    <!--
    "flexGrow":      photo.width * 100 / photo.height,
    "flexBasis":     photo.width * 240 / photo.height,
    "paddingBottom": photo.height / photo.width * 100,
    -->

    {{ $resources := .Resources.Match "*.jpg" }}
    {{ range sort $resources ".Name"}}
    {{ $image := .}}
    {{ $thumbImage := .Resize "x512 q80"}}
    {{/* $caption :=  .Name | replaceRE "\\..*" "" | humanize */}}

    <!-- TODO thumbnails -->
      
    <img src="{{ $thumbImage.Permalink }}" imgW="{{ $image.Width }}" imgH="{{ $image.Height }}" >

    {{ end }}

    </div> 

    <script>
      jQuery(function ($) {
        $(".grid img").each(function (i) {
          var src = $(this).attr("src"),
            h = $(this).attr("imgH"),
            w = $(this).attr("imgW"),
            flexGrow = (w * 200) / h,
            flexBasis = (w * 280) / h,
            paddingBottom = (h / w) * 100;
          $(this)
            .attr("alt", "kitten-" + (i + 1))
            .wrap("<figure>")
            .before("<i>");

          var figure = $(this).parent("figure");
          figure
            .css({
              "flex-grow": flexGrow,
              "flex-basis": flexBasis + "px"
            })
            .find("i")
            .css({
              "padding-bottom": paddingBottom + "%"
            });

            $('<a>',{
              href: src,    
              itemprop: 'contentUrl'
            }).appendTo(figure);

          var img = new Image();
          img.onload = function () {
            figure.addClass("loaded");
          };
          img.src = src;
        });
      });
  </script>

<!-- TODO must remove it when removed from partial -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  {{ partial "load-photoswipe.html" . }}

</body>
</html>