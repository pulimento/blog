<!DOCTYPE html>
<html>

<!-- https://codepen.io/pasyuk/pen/vgQgyb -->
<!-- https://github.com/liwenyip/hugo-easy-gallery -->

{{ partial "head_photos.html" . }}

<body>
  <h1>Heeeelelo from layouts!!!</h1>

  <div class="grid p4 p-responsive wrap">

    <!--
    "flexGrow":      photo.width * 100 / photo.height,
    "flexBasis":     photo.width * 240 / photo.height,
    "paddingBottom": photo.height / photo.width * 100,
    -->

    {{ $resources := .Resources.Match "*.jpg" }}
    {{ range sort $resources ".Name"}}
    {{ $image := .}}
    {{ $thumbImage := .Resize "x512 q80"}}
    {{/* $caption :=  .Name | replaceRE "\\..*" "" | humanize */}}

    <!-- TODO thumbnails -->
      
    <img src="{{ $thumbImage.Permalink }}" imgW="{{ $image.Width }}" imgH="{{ $image.Height }}" >

    {{ end }}

    </div> 


    <script>
      var elements = document.querySelectorAll(".grid img");        
      Array.prototype.forEach.call(elements, function (element, i) {  
          var src = element.getAttribute("src"),
          h = element.getAttribute("imgH"),
          w = element.getAttribute("imgW"),
          flexGrow = (w * 200) / h,
          flexBasis = (w * 280) / h,
          paddingBottom = (h / w) * 100;

          element.setAttribute("alt", "kitten-" + (i + 1))

          var parentFigure = document.createElement('figure');
          element.parentNode.insertBefore(parentFigure, element);
          parentFigure.appendChild(element);

          var inode = document.createElement('i');
          parentFigure.insertBefore(inode, element);

          parentFigure.style.cssText = "flex-grow:" + flexGrow + ";flex-basis: " + flexBasis + "px";
          inode.style.cssText = "padding-bottom:" + paddingBottom + "%";

          var link = document.createElement('a');
          link.href = src;
          link.setAttribute('itemprop', 'contentUrl');
          parentFigure.appendChild(link);

          var img = new Image();
          img.onload = function () {
            parentFigure.classList.add("loaded");
          };
          img.src = src;
      });        
  </script>

<!-- TODO must remove it when removed from partial -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  {{ partial "load-photoswipe.html" . }}

</body>
</html>